<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gemini AI Chatbot</title>
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='images/iba_logo.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            margin: 0 auto 40px;
            background-color: #101626;
            color: #fff;
        }
        .skeleton {
            min-height: 18px;
            padding: 10px;
            border-radius: 4px;
            background-color: #3A4556;
            background-size: 40px 100%;
            background-repeat: no-repeat;
            background-position: left -40px top 0;
            animation: shine 1s ease infinite;
        }
        @keyframes shine {
            to {
                background-position: right -40px top 0;
            }
        }
        .chat-container {
            max-width: 75%;
            margin: 0 auto;
        }
    </style>
</head>
<body class="py-3">
    <main class="flex-shrink-0">
        <div class="chat-container">
            <h1 class="mt-3">Gemini AI Model - Free Chatbot</h1>
            <p>A continuous conversation chatbot powered by the free Gemini API. This project leverages conversation history to provide more relevant and context-aware responses.</p>
            <br>
            <div id="list-group" style="background-color: #101626;" class="list-group w-auto">
            </div>
            <div class="input-group p-3 fixed-bottom chat-container" style="margin: 0 auto;">
                <input type="text" class="form-control" id="chat-input"
                    style="background-color: #3A4556; border: #3A4556; color: #fff;">
                <div class="input-group-append">
                    <button id="gemini-button" style="background-color: #140b9d; color: white; border-radius: 0 5px 5px 0;"
                        class="btn">Ask Gemini</button>
                </div>
            </div>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script>
        $("#gemini-button").click(function () {
            var prompt = $("#chat-input").val();
            if (prompt.trim() === "") {
                return;
            }
            // Append user's message
            $("#list-group").append(`
                <a style="margin-top:-10px; background-color:#3A4556; border:none; color:white;"
                   class="list-group-item list-group-item-action d-flex gap-3 py-3">
                    <img src="https://w7.pngwing.com/pngs/178/595/png-transparent-user-profile-computer-icons-login-user-avatars-thumbnail.png"
                         alt="User Avatar" width="32" height="32" class="rounded-circle flex-shrink-0">
                    <div class="d-flex gap-2 w-100 justify-content-between">
                        <div>
                            <p class="mb-0 opacity-75">${prompt}</p>
                        </div>
                    </div>
                </a>
            `);
            $("#chat-input").val("");
            // Append placeholder for Gemini's response
            let placeholderHtml = `
                <div id="gemini-response" class="py-3">
                    <div class="skeleton" style="width: 70%;"></div>
                    <div class="skeleton mt-2" style="width: 50%;"></div>
                    <div class="skeleton mt-2" style="width: 60%;"></div>
                </div>
            `;
            $("#list-group").append(placeholderHtml);
            // Scroll to the new message
            $('html, body').animate({
                scrollTop: $(document).height()
            }, 100);
            $.ajax({
                type: "POST",
                url: "/chat",
                contentType: "application/json",
                data: JSON.stringify({'prompt': prompt}),
                success: function (data) {
                    // Remove the placeholder
                    $("#gemini-response").remove();
                    // Append Gemini's actual response
                    let gpt_data = `
                        <a style="background-color:#202835; border:black;" href="#"
                           class="list-group-item list-group-item-action d-flex gap-3 py-3">
                            <img src="{{ url_for('static', filename='images/iba_logo.png') }}"
                                 alt="Gemini Avatar" width="32" height="32" class="rounded-circle flex-shrink-0">
                            <div class="d-flex gap-2 w-100 justify-content-between">
                                <div>
                                    <p class="mb-0 opacity-75 text-white">${data.answer}</p>
                                </div>
                            </div>
                        </a><br>
                    `;
                    $("#list-group").append(gpt_data);
                    // Scroll to the new message
                    $('html, body').animate({
                        scrollTop: $(document).height()
                    }, 100);
                }
            });
        });
    </script>
</body>
</html>